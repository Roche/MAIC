<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matching-Adjusted Indirect Comparison: Anchored example using the <tt>MAIC</tt> package • MAIC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Matching-Adjusted Indirect Comparison: Anchored example using the &lt;tt&gt;MAIC&lt;/tt&gt; package">
<meta property="og:description" content="MAIC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SGZFXJEC6X"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SGZFXJEC6X');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAIC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignette
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Unanchored example</li>
    <li>
      <a href="../articles/MAIC.html"></a>
    </li>
    <li class="dropdown-header">Anchored example</li>
    <li>
      <a href="../articles/MAIC_anchored.html"></a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/index.html" class="external-link">Global-HTA-Evidence-Open</a>
    </li>
    <li>
      <a href="https://roche.github.io/flexsurvPlus/index.html" class="external-link">flexsurvPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/gemtcPlus/index.html" class="external-link">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/MAIC/index.html" class="external-link">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/rpsftmPlus/index.html" class="external-link">rpsftmPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/descem/index.html" class="external-link">descem</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche/MAIC" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Matching-Adjusted Indirect Comparison: Anchored example using the <tt>MAIC</tt> package</h1>
                        <h4 data-toc-skip class="author">Roche</h4>
            
            <h4 data-toc-skip class="date">2023-01-17</h4>
      
      
      <div class="hidden name"><code>MAIC_anchored.Rmd</code></div>

    </div>

    
    
<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 10px;
}
h1.title {
  font-size: 38px;
}
h1 { /* Header 1 */
  font-size: 28px;
  }
h2 { /* Header 2 */
    font-size: 22px;
}
h3 { /* Header 3 */
  font-size: 18px;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
<div class="section level2">
<h2 id="survival-example-of-anchored-maic">Survival example of anchored MAIC<a class="anchor" aria-label="anchor" href="#survival-example-of-anchored-maic"></a>
</h2>
<p>The first section of this document goes over an anchored example of matching-adjusted indirect comparison (MAIC) analysis using the <tt>MAIC</tt> package in R where the endpoint of interest is time-to-event (e.g. overall survival). An “anchored” indirect comparison is when the two studies in comparison share a common treatment arm (i.e. placebo). For more details regarding MAIC, we ask the readers to refer to the unanchored example.</p>
<div class="section level3">
<h3 id="set-up-r-packages">Set up R packages<a class="anchor" aria-label="anchor" href="#set-up-r-packages"></a>
</h3>
<p>The following packages are required to run this example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#devtools::install_github("roche/MAIC", ref = "main")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MAIC</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">boot</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-sample-data">Generate sample data<a class="anchor" aria-label="anchor" href="#generate-sample-data"></a>
</h3>
<p>We use the method described in Bender et al. to simulate survival times. <span class="citation">[1]</span> The following R code generates a dataset with a treatment indicator, a prognostic variable (<span class="math inline">\(x_1\)</span>), and two effect modifiers (<span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_3\)</span>). We assume that <span class="math inline">\(x_1\)</span> is not effect modifying, <span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_3\)</span> are also prognostic, and all three covariates are binary for simplicity. We simulate baseline hazard from a Weibull distribution and censoring times from an exponential distribution.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Code is adapted from https://stats.stackexchange.com/questions/135124/how-to-create-a-toy-survival-time-to-event-data-with-right-censoring</span></span>
<span></span>
<span><span class="co"># N: sample size    </span></span>
<span><span class="co"># lambda: scale parameter in baseline hazard function</span></span>
<span><span class="co"># rho: shape parameter in baseline hazard function</span></span>
<span><span class="co"># rateC: rate parameter of the exponential distribution of C</span></span>
<span><span class="co"># beta: vector of coefficients for prognostic factors</span></span>
<span><span class="co"># gamma: vector of coefficients for effect modifiers</span></span>
<span><span class="co"># d0: coefficient for the treatment effect when X = 0</span></span>
<span><span class="co"># xcutoff: vector of points where the continuous variables are cut to make them to binary predictors. </span></span>
<span><span class="co"># The bigger the number less frequent the covariates are equal to 1.</span></span>
<span></span>
<span><span class="va">simulWeib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">lambda</span>, <span class="va">rho</span>, <span class="va">rateC</span>, <span class="va">beta</span>, <span class="va">gamma</span>, <span class="va">d0</span>, <span class="va">xcutoff</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> <span class="co">#seed number that is used to make simulation replicable</span></span>
<span>  </span>
<span>  <span class="co"># generate 3 covariates with some correlation</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fl">0.5</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="co">#variance covariance</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">xcutoff</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># make it a binary predictor</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, size<span class="op">=</span><span class="va">N</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># linear predictor</span></span>
<span>  <span class="va">lp</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span> <span class="op">+</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">d0</span> <span class="op">*</span> <span class="va">treat</span></span>
<span>  </span>
<span>  <span class="co"># Weibull latent event times</span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">N</span><span class="op">)</span></span>
<span>  <span class="va">Tlat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">rho</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># censoring times</span></span>
<span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">N</span>, rate<span class="op">=</span><span class="va">rateC</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># follow-up times and event indicators</span></span>
<span>  <span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">Tlat</span>, <span class="va">C</span><span class="op">)</span></span>
<span>  <span class="va">Event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Tlat</span> <span class="op">&lt;=</span> <span class="va">C</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># data set</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>USUBJID<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, Time<span class="op">=</span><span class="va">Time</span>, Event<span class="op">=</span><span class="va">Event</span>, </span>
<span>             x1<span class="op">=</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, x2 <span class="op">=</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, x3 <span class="op">=</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, treat <span class="op">=</span> <span class="va">treat</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We use notation from National Institute for Health and Care Excellence (NICE) Decision Support Unit (DSU) Technical Support Document (TSD) 18 to denote treatment effects for different population. <span class="citation">[2]</span> We denote treatment effect of <span class="math inline">\(B\)</span> vs <span class="math inline">\(A\)</span> in target population <span class="math inline">\(P\)</span> when <span class="math inline">\(X = 0\)</span> as <span class="math inline">\(d_{AB(P)}(0)\)</span>. Let us generate the first study with only treatments <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> and we will denote this study population as <span class="math inline">\(P=AB\)</span>. In this study, we assume that <span class="math inline">\(d_{AB(AB)}(0)=-0.4\)</span></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate first study</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="co"># first variable has no effect modification</span></span>
<span><span class="va">d0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span></span>
<span><span class="va">xcutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">dataAB</span> <span class="op">&lt;-</span> <span class="fu">simulWeib</span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, lambda <span class="op">=</span> <span class="fl">0.1</span>, rho <span class="op">=</span> <span class="fl">1</span>, rateC <span class="op">=</span> <span class="fl">0.01</span>, beta <span class="op">=</span> <span class="va">beta</span>, gamma <span class="op">=</span> <span class="va">gamma</span>, d0 <span class="op">=</span> <span class="va">d0</span>, xcutoff <span class="op">=</span> <span class="va">xcutoff</span><span class="op">)</span></span>
<span><span class="va">dataAB</span><span class="op">$</span><span class="va">ARM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dataAB</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the second study, we slightly change how the covariates (i.e. effect modifiers) are distributed. We use different cutoffs for the covariates to make the baseline characteristics different from the <span class="math inline">\(AB\)</span> study. In this study, we assume that <span class="math inline">\(d_{AC(AC)}(0)=-0.7\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate second study</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span> </span>
<span><span class="va">d0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.7</span></span>
<span><span class="va">xcutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">dataAC</span> <span class="op">&lt;-</span> <span class="fu">simulWeib</span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, lambda <span class="op">=</span> <span class="fl">0.1</span>, rho <span class="op">=</span> <span class="fl">1</span>, rateC <span class="op">=</span> <span class="fl">0.01</span>, beta <span class="op">=</span> <span class="va">beta</span>, gamma <span class="op">=</span> <span class="va">gamma</span>, d0 <span class="op">=</span> <span class="va">d0</span>, xcutoff <span class="op">=</span> <span class="va">xcutoff</span><span class="op">)</span></span>
<span><span class="va">dataAC</span><span class="op">$</span><span class="va">ARM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dataAC</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"C"</span>, <span class="st">"A"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>What is the effect of average treatment effect of B vs A when the target population <span class="math inline">\(P=AC\)</span>? We denote this by <span class="math inline">\(d_{AB(AC)}\)</span> and generate it by the data generating mechanism. We use the same effect estimates (beta, gamma, d0) for the treatment effect of B vs A, but use the covariate distribution from AC trial (xcutoff). Then we use cox regression to estimate <span class="math inline">\(d_{AB(AC)}\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="co"># first variable has no effect modification</span></span>
<span><span class="va">d0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span></span>
<span><span class="va">xcutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">dataAB_AC</span> <span class="op">&lt;-</span> <span class="fu">simulWeib</span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, lambda <span class="op">=</span> <span class="fl">0.1</span>, rho <span class="op">=</span> <span class="fl">1</span>, rateC <span class="op">=</span> <span class="fl">0.01</span>, beta <span class="op">=</span> <span class="va">beta</span>, gamma <span class="op">=</span> <span class="va">gamma</span>, d0 <span class="op">=</span> <span class="va">d0</span>, xcutoff <span class="op">=</span> <span class="va">xcutoff</span><span class="op">)</span></span>
<span><span class="va">dataAB_AC</span><span class="op">$</span><span class="va">ARM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dataAB_AC</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">unweighted_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dataAB_AC</span><span class="op">)</span></span>
<span><span class="va">d_AB_AC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">unweighted_cox</span><span class="op">)</span></span>
<span><span class="va">d_AB_AC</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(Time, Event == 1) ~ treat, data = dataAB_AC)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 10000, number of events= 9193 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           coef exp(coef) se(coef)      z Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; treat -0.22588   0.79782  0.02101 -10.75   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; treat    0.7978      1.253    0.7656    0.8313</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.527  (se = 0.003 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 115.6  on 1 df,   p=&lt;2e-16</span></span>
<span><span class="co">#&gt; Wald test            = 115.6  on 1 df,   p=&lt;2e-16</span></span>
<span><span class="co">#&gt; Score (logrank) test = 116.1  on 1 df,   p=&lt;2e-16</span></span></code></pre></div>
<p>By using the data generating mechanism, we find that the estimate <span class="math inline">\(\hat{d}_{AB(AC)}=\)</span> -0.2259.</p>
</div>
<div class="section level3">
<h3 id="estimating-weights-via-maic">Estimating weights via MAIC<a class="anchor" aria-label="anchor" href="#estimating-weights-via-maic"></a>
</h3>
<p>Although we have full data for the <span class="math inline">\(AC\)</span> dataset, let us assume that we only have aggregate level data for the <span class="math inline">\(AC\)</span> study. Our task is to estimate <span class="math inline">\(d_{AB(AC)}\)</span> with individual patient data of <span class="math inline">\(AB\)</span> study and aggregate level summary of <span class="math inline">\(AC\)</span> study through utilizing MAIC. Below, we calculate aggregate average of covariates for each population.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dataAB</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;     x1     x2     x3 </span></span>
<span><span class="co">#&gt; 0.5046 0.3064 0.3113</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dataAC</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;     x1     x2     x3 </span></span>
<span><span class="co">#&gt; 0.3117 0.5042 0.6907</span></span></code></pre></div>
<p>We apply the same steps as the unanchored example to find the weights to adjust for differences in effect modifiers in <span class="math inline">\(AB\)</span> and <span class="math inline">\(AC\)</span> trials.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intervention_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">dataAB</span><span class="op">)</span></span>
<span><span class="va">target_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, Treatment <span class="op">=</span> <span class="st">"Comparator"</span>, </span>
<span>                     x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dataAC</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dataAC</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>, </span>
<span>                     x3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dataAC</span><span class="op">$</span><span class="va">x3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">all_cov</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">intervention_input</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_centered"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">intervention_input</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">target_pop</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Need to update match_cov parameter if we change covariates we are using to match</span></span>
<span><span class="va">match_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x2"</span>, <span class="st">"x3"</span><span class="op">)</span></span>
<span><span class="va">cent_match_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">match_cov</span>, <span class="st">"_centered"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="co">#deal with select function clashes between dplyr and MASS packages</span></span>
<span><span class="va">intervention_data</span> <span class="op">&lt;-</span> <span class="va">intervention_input</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">ARM</span>, <span class="va">Time</span>, <span class="va">Event</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">match_cov</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">cent_match_cov</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove any NA; or deal with missing data problem via multiple imputation if simply removing NA is problematic</span></span>
<span><span class="co">#intervention_data &lt;- intervention_data[complete.cases(intervention_data),] </span></span>
<span></span>
<span><span class="va">est_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_weights.html">estimate_weights</a></span><span class="op">(</span>intervention_data <span class="op">=</span> <span class="va">intervention_data</span>,</span>
<span>                                matching_vars <span class="op">=</span> <span class="va">cent_match_cov</span><span class="op">)</span></span>
<span><span class="va">intervention_data</span><span class="op">$</span><span class="va">wt</span> <span class="op">&lt;-</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span><span class="op">$</span><span class="va">wt</span></span>
<span></span>
<span><span class="fu"><a href="../reference/wt_diagnostics.html">wt_diagnostics</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span><span class="op">)</span>, vars <span class="op">=</span> <span class="va">match_cov</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ESS</span></span>
<span><span class="co">#&gt; [1] 5813.605</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Summary_of_weights</span></span>
<span><span class="co">#&gt;               type      mean        sd    median       min      max</span></span>
<span><span class="co">#&gt; 1          Weights 0.7285302 0.6182536 0.3008227 0.3008227 1.882276</span></span>
<span><span class="co">#&gt; 2 Rescaled weights 1.0000000 0.8486314 0.4129173 0.4129173 2.583662</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Weight_profiles</span></span>
<span><span class="co">#&gt;   x2 x3        wt     wt_rs</span></span>
<span><span class="co">#&gt; 1  0  0 0.3008227 0.4129173</span></span>
<span><span class="co">#&gt; 2  1  0 0.4269752 0.5860776</span></span>
<span><span class="co">#&gt; 3  0  1 1.3261454 1.8203027</span></span>
<span><span class="co">#&gt; 4  1  1 1.8822756 2.5836618</span></span>
<span><span class="fu"><a href="../reference/check_weights.html">check_weights</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, <span class="va">match_cov</span>, <span class="va">target_pop</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     ARM   ESS        x2        x3</span></span>
<span><span class="co">#&gt; 1          Intervention 10000 0.3064000 0.3113000</span></span>
<span><span class="co">#&gt; 2 Intervention_weighted  5814 0.5041816 0.6907061</span></span>
<span><span class="co">#&gt; 3            Comparator 10000 0.5042000 0.6907000</span></span></code></pre></div>
<p>Now that weights has been calculated, we can calculate the weighted hazard ratios.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unweighted_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span>, data <span class="op">=</span> <span class="va">intervention_data</span><span class="op">)</span></span>
<span><span class="va">weighted_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span>, data <span class="op">=</span> <span class="va">intervention_data</span>, weights <span class="op">=</span> <span class="va">wt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">HR_AB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_RR.html">find_RR</a></span><span class="op">(</span><span class="va">unweighted_cox</span><span class="op">)</span></span>
<span><span class="va">HR_AB_MAIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_RR.html">find_RR</a></span><span class="op">(</span><span class="va">weighted_cox</span><span class="op">)</span></span></code></pre></div>
<p>We find that the unweighted hazard ratio is -0.3004 and the weighted hazard ratio adjusting for the imbalance of effect modifiers to match the AC trial is -0.2257. Using the weights, hazard ratio is closer to the estimated hazard ratio from data generating mechanism, which was -0.2259.</p>
</div>
<div class="section level3">
<h3 id="calculating-indirect-treatment-comparison">Calculating indirect treatment comparison<a class="anchor" aria-label="anchor" href="#calculating-indirect-treatment-comparison"></a>
</h3>
<p>If AC trial was the comparator trial and only aggregate level summary was reported, we might only have information about the hazard ratio and confidence interval from the publication.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unweighted_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dataAC</span><span class="op">)</span></span>
<span><span class="va">RR_AC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_RR.html">find_RR</a></span><span class="op">(</span><span class="va">unweighted_cox</span><span class="op">)</span></span>
<span><span class="va">RR_AC</span></span>
<span><span class="co">#&gt; $HR</span></span>
<span><span class="co">#&gt;     treat </span></span>
<span><span class="co">#&gt; 0.6377071 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_SE</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; 0.01365808 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_CI</span></span>
<span><span class="co">#&gt;     lower     upper </span></span>
<span><span class="co">#&gt; 0.6114918 0.6650463 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; -0.4498762 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR_SE</span></span>
<span><span class="co">#&gt; [1] 0.02141749</span></span></code></pre></div>
<p>For instance, we would only know that for AC trial, hazard ratio was 0.64 and 95% confidence interval was [0.61, 0.67]. However, what we need for the indirect treatment comparison is log hazard ratio and its standard error. We use the following function to calculate these estimates.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HR_AC</span> <span class="op">&lt;-</span> <span class="va">RR_AC</span><span class="op">$</span><span class="va">HR</span></span>
<span><span class="va">HR_CI_AC</span> <span class="op">&lt;-</span> <span class="va">RR_AC</span><span class="op">$</span><span class="va">HR_CI</span></span>
<span></span>
<span><span class="va">HR_AC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_SE_fromCI.html">find_SE_fromCI</a></span><span class="op">(</span>Estimate <span class="op">=</span> <span class="va">HR_AC</span>, CI_lower <span class="op">=</span> <span class="va">HR_CI_AC</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, CI_upper <span class="op">=</span> <span class="va">HR_CI_AC</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, CI_perc <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">HR_AC</span></span>
<span><span class="co">#&gt; $HR</span></span>
<span><span class="co">#&gt;     treat </span></span>
<span><span class="co">#&gt; 0.6377071 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_SE</span></span>
<span><span class="co">#&gt;      upper </span></span>
<span><span class="co">#&gt; 0.01365808 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_CI</span></span>
<span><span class="co">#&gt;     lower     upper </span></span>
<span><span class="co">#&gt; 0.6114918 0.6650463 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; -0.4498762 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR_SE</span></span>
<span><span class="co">#&gt;      upper </span></span>
<span><span class="co">#&gt; 0.02141749</span></span></code></pre></div>
<p>In the previous section, we have estimated is <span class="math inline">\(d_{AB(AC)}\)</span>, but what we are more interested is the indirect treatment comparison of C vs B. We can calculate <span class="math inline">\(\hat{d}_{BC(AC)}\)</span> from <span class="math inline">\(\hat{d}_{BC(AC)}\)</span> = <span class="math inline">\(\hat{d}_{AC(AC)}\)</span> - <span class="math inline">\(\hat{d}_{AB(AC)}\)</span>. We can calculate this indirect effect of C vs B through the function below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Naive indirect effect of C vs B</span></span>
<span><span class="fu"><a href="../reference/find_ITC.html">find_ITC</a></span><span class="op">(</span>AB <span class="op">=</span> <span class="va">HR_AB</span>, AC <span class="op">=</span> <span class="va">HR_AC</span><span class="op">)</span></span>
<span><span class="co">#&gt; $HR</span></span>
<span><span class="co">#&gt;     treat </span></span>
<span><span class="co">#&gt; 0.8611307 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_SE</span></span>
<span><span class="co">#&gt;      upper </span></span>
<span><span class="co">#&gt; 0.02590627 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_CI</span></span>
<span><span class="co">#&gt;     lower     upper </span></span>
<span><span class="co">#&gt; 0.8118233 0.9134329 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; -0.1495089 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR_SE</span></span>
<span><span class="co">#&gt;      upper </span></span>
<span><span class="co">#&gt; 0.03008401</span></span>
<span></span>
<span><span class="co"># Matching adjusted indirect comparison of C vs B</span></span>
<span><span class="fu"><a href="../reference/find_ITC.html">find_ITC</a></span><span class="op">(</span>AB <span class="op">=</span> <span class="va">HR_AB_MAIC</span>, AC <span class="op">=</span> <span class="va">HR_AC</span><span class="op">)</span></span>
<span><span class="co">#&gt; $HR</span></span>
<span><span class="co">#&gt;     treat </span></span>
<span><span class="co">#&gt; 0.7991365 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_SE</span></span>
<span><span class="co">#&gt;      upper </span></span>
<span><span class="co">#&gt; 0.02604207 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_CI</span></span>
<span><span class="co">#&gt;     lower     upper </span></span>
<span><span class="co">#&gt; 0.7496909 0.8518433 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; -0.2242235 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR_SE</span></span>
<span><span class="co">#&gt;      upper </span></span>
<span><span class="co">#&gt; 0.03258776</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bootstrapping-a-confidence-interval">Bootstrapping a confidence interval<a class="anchor" aria-label="anchor" href="#bootstrapping-a-confidence-interval"></a>
</h3>
<p>Similarly as in the unanchored example, we can estimate a 95% confidence interval (CI) from the bootstrap samples. We will use Percentile CIs, but we could have also used Bias-corrected and accelerated CIs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">boot</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">HR_bootstraps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">intervention_data</span>,</span>
<span>                      statistic <span class="op">=</span> <span class="va">bootstrap_HR_anchored</span>, </span>
<span>                      R<span class="op">=</span><span class="va">R</span>, <span class="co"># number of bootstrap samples </span></span>
<span>                      matching <span class="op">=</span> <span class="va">cent_match_cov</span>, <span class="co"># matching variables</span></span>
<span>                      ref_treatment <span class="op">=</span> <span class="st">"A"</span>, <span class="co"># reference treatment name</span></span>
<span>                      model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span> <span class="co"># model to fit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">RR_AB_MAIC_BOOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>logHR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">HR_bootstraps</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>, logHR_SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">HR_bootstraps</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">RR_BC_MAIC_BOOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_ITC.html">find_ITC</a></span><span class="op">(</span>AB <span class="op">=</span> <span class="va">RR_AB_MAIC_BOOT</span>, AC <span class="op">=</span> <span class="va">RR_AC</span><span class="op">)</span></span>
<span><span class="va">RR_BC_MAIC_BOOT</span></span>
<span><span class="co">#&gt; $HR</span></span>
<span><span class="co">#&gt;     treat </span></span>
<span><span class="co">#&gt; 0.8000753 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_SE</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; 0.02780164 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $HR_CI</span></span>
<span><span class="co">#&gt;     lower     upper </span></span>
<span><span class="co">#&gt; 0.7473992 0.8564639 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR</span></span>
<span><span class="co">#&gt;      treat </span></span>
<span><span class="co">#&gt; -0.2230495 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logHR_SE</span></span>
<span><span class="co">#&gt; [1] 0.03474878</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body">
<div id="ref-Bender2005" class="csl-entry">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">Bender R, Augustin T, Blettner M. Generating survival times to simulate cox proportional hazards models. Statistics in Medicine 2005;24:1713–23.</div>
</div>
<div id="ref-phillippo2016a" class="csl-entry">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">Phillippo D, Ades T, Dias S, Palmer S, Abrams KR, Welton N. NICE DSU technical support document 18: Methods for population-adjusted indirect comparisons in submissions to NICE 2016.</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jo Gregory, Sarah Smith, Richard Birnie, Michael Seo, Iain Bennett.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
